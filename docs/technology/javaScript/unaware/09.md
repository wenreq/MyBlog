---
lang: zh-CN
title: 4. 混合对象 “类”
description: 混合对象 “类”
---

面向类的设计模式：实例化、继承和（相对）多态。

## 4.1 类理论

面向对象编程强调的是数据和操作数据的行为本质上是互相关联的，因此好的设计就是**把数据以及和它相关的行为打包**（或者说封装）起来。这在正式的计算机科学中有时被称为数据结构。

举例来说，用来表示一个单词或者短语的一串字符通常被称为字符串。字符就是数据。但是你关心的往往不是数据是什么，而是*可以对数据做什么*，所以可以应用在这种数据上的行为（计算长度、添加数据、搜索，等等）都被设计成 `String` 类的方法。

所有字符串都是 `String` 类的一个实例，也就是说它是一个包裹，包含字符数据和我们可以应用在数据上的函数。

我们还可以使用类对数据结构进行分类，可以把任意数据结构看作范围更广的定义的一种特例。

我们来看一个常见的例子，“汽车” 可以被看作 “交通工具” 的一种特例，后者是更广泛的类。我们可以在软件中定义一个 `Vehicle` 类和一个 `Car` 类来对这种关系进行建模。

`Vehicle` 的定义可能包含推进器（比如引擎）、载人能力等等，这些都是 `Vehicle` 的行为。我们在 `Vehicle` 中定义的是（几乎）所有类型的交通工具（飞机、火车和汽车）都包含的东西。

在我们的软件中，对不同的交通工具重复定义 “载人能力” 是没有意义的。相反，我们只在 `Vehicle` 中定义一次，定义 `Car` 时，只要**声明它继承**（或者**扩展**）了 `Vehicle` 的这个基础定义就行。`Car` 的定义就是对通用 `Vehicle` 定义的**特殊化**。

虽然 `Vehicle` 和 `Car` 会定义相同的方法，但是**实例中的数据可能是不同的**，比如每辆车独一无二的 `VIN`（`Vehicle Identification Number`，车辆识别号码），等等。

这就是类、继承和实例化。

类的另一个核心概念是**多态**，这个概念是说父类的通用行为可以被子类用更特殊的行为重写。实际上，相对多态允许我们**从重写行为中引用基础行为**。

类理论强烈建议父类和子类使用**相同的方法名**来表示特定的行为，从而让子类**重写**父类。我们之后会看到，在 JavaScript 代码中这样做会降低代码的可读性和健壮性。

### 4.1.1 “类” 设计模式

你可能从来没把类作为设计模式来看待，讨论得最多的是面向对象设计模式，比如迭代器模式、观察者模式、工厂模式、单例模式，等等。从这个角度来说，我们似乎是在（低级）面向对象类的基础上实现了所有（高级）设计模式，似乎面向对象是优秀代码的基础。

如果你有函数式编程（比如 Monad）的经验就会知道类也是非常常用的一种设计模式。但是对于其他人来说，这可能是第一次知道类并不是必须的编程基础，而是一种可选的代码抽象。

有些语言（比如 Java）并不会给你选择的机会，类并不是可选的——万物皆是类。

### 4.1.2 JavaScript中的 “类”

JavaScript 只有一些近似类的语法元素（比如 `new` 和 `instanceof`），不过在后来的 `ES6` 中新增了一些元素，比如 `class` 关键字。

## 4.2 类的机制

在许多面向类的语言中，“标准库”会提供 `Stack` 类，它是一种 “栈” 数据结构（支持压入、弹出，等等）。`Stack` 类内部会有一些变量来存储数据，同时会提供一些公有的可访问行为（“方法”），从而让你的代码可以和（隐藏的）数据进行交互（比如添加、删除数据）。

但是在这些语言中，你实际上并不是直接操作 `Stack`。`Stack` 类仅仅是一个抽象的表示，它描述了所有 “栈” 需要做的事，但是它本身并不是一个 “栈”。你必须先实例化 `Stack` 类然后才能对它进行操作。

### 4.2.1 建造

一个类就是一张蓝图。为了获得真正可以交互的对象，我们必须按照**类**来建造（也可以说实例化）一个东西，这个东西通常被称为**实例**，有需要的话，我们可以直接在实例上调用方法并访问其所有公有数据属性。

你通常也不会使用一个实例对象来直接访问并操作它的类，不过至少可以**判断**出这个实例对象来自哪个类。

把类和实例对象之间的关系看作是直接关系而不是间接关系通常更有助于理解。类通过复制操作被实例化为对象形式：

### 4.2.2 构建函数

类实例是由一个特殊的**类方法**构造的，这个方法名通常和类名相同，被称为**构造函数**。这个方法的任务就是**初始化实例需要的所有信息**。

```js
class CoolGuy {
  specialTrick = nothing

  CoolGuy( trick ) {
    specialTrick = trick
  }

  showOff () {
    output("Here's my trick: ", specialTrick)
  }
}
```

我们可以调用类构造函数来生成一个 `CoolGuy` 实例：

```js
Joe = new CoolGuy( "jumping rope" )
Joe.showOff() //Here's my trick:：jumping rope
```

注意，`CoolGuy` 类有一个 `CoolGuy()` 构造函数，执行 `new CoolGuy()` 时实际上调用的就是它。构造函数会返回一个对象（也就是类的一个实例），之后我们可以在这个对象上调用 `showOff()` 方法，来输出指定 `CoolGuy` 的特长。

类构造函数属于类，而且通常和类同名。此外，构造函数大多需要用 `new` 来调，这样语言引擎才知道你想要构造一个新的类实例。

## 4.3 类的继承

### 4.3.1 多态

### 4.3.2 多重继承

## 4.4 混入

### 4.4.1 显式混入

#### 1. 再说多态

#### 2. 混合复制

#### 3. 寄生继承

### 4.4.2 隐式混入

## 4.5 小结
