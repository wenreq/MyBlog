---
lang: zh-CN
title: 27. node_modules 拓扑结构
description: node_modules 拓扑结构
---

# 请描述 node_modules 的目录结构（拓扑结构）

## 基础

当 `require('package-hello')` 时，假设 `package-hello` 是个 npm 库，我们是如何找到该 `package` 的？

1. 寻找当前目录的 `node_modules/package-hello` 目录
2. 如果未找到，寻找上一级的 `../node_modules/package-hello` 目录，以此递归查找

## 很久以前：嵌套结构

在 `npm v2` 时，`node_modules` 对于各个 package 的拓扑为嵌套结构。

假设：

1. 项目依赖 `package-a` 与 `package-b` 两个 package
2. `package-a` 与 `package-b` 均依赖 `lodash@4.17.4`

依赖关系以 Markdown 列表表示：

```md
- package-a
  - `lodash@4.17.4`
- package-b
  - `lodash@4.17.4`
```

此时 `node_modules` 目录结构如下：

```sh
graph
  app(node_modules) ---> A(package-a)
  app          ---> B(package-b)
  A            ---> C("lodash@4.17.4")
  B            ---> D("lodash@4.17.4")
```

此时最大的问题

1. 嵌套过深
2. 占用空间过大

## 现在阶段：平铺结构

> 目前在 npm/yarn 中仍然为平铺结构，但 pnpm 使用了更省空间的方法。


