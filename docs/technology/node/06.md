---
title: express
lang: zh-CN
---

## 目标

- 使用 `express.static()` 快速托管静态资源
- 使用 express **路由**精简项目结构
- 使用常见的 express **中间件**
- 使用 express 创建 API **接口**
- 在 express 中启用 `cors` 跨域资源共享

## 目录

- 初识 Express
- Express 路由
- Express 中间件
- 使用 Express 写接口

## 1. 初识 Express

### 1.1 简介

官方：Express 是基于 Node.js 平台，快速、开放、极简的 Web 开发框架。

通俗理解：Express 的作用和 Node.js 内置的 http 模块类似，是专门用来创建 Web 服务器的。

本质：就是一个 npm 上的第三方包，提供快速创建 Web 服务器的便捷方法。

### 1.2 基本用法

1. 安装：`npm i express@4.17.1`

2. 创建基本的 Web 服务器

```js
// 1. 导入 express
const express = require("express");
// 2. 创建 web 服务器
const app = express();

// 3. 调用 app.listen (端口号，启动成功后的回调函数)，启动服务器
app.listen(80, () => {
  console.log("express server running at http://127.0.0.1");
});
```

#### 监听 GET、POST 请求

通过 `app.get()` 方法，可以监听客户端的 GET 请求。

```js
// req: 请求对象
// res: 响应对象
app.get("请求URL", function (req, res) {
  /* 处理函数 */
});
```

通过 `app.post()` 方法，可以监听客户端的 POST 请求。

```js
// req: 请求对象
// res: 响应对象
app.post("请求URL", function (req, res) {
  /* 处理函数 */
});
```

#### 把内容响应给客户端

通过 `res.send()` 方法，可以把处理好的内容，发送给客户端：

```js
app.get("/user", (req, res) => {
  // 向客户端发送 JSON 对象
  res.send({ name: "zs", age: 28, gender: "男" });
});

app.post("/user", (req, res) => {
  // 向客户端发送文本内容
  res.send("请求成功");
});
```

#### 获取 URL 中携带的查询参数

通过 `req.query` 对象，可以访问到客户端通过查询字符串的形式，发送到服务的参数。

#### 获取 URL 中的动态参数

通过 `req.params` 对象，可以访问到 URL 中，通过 `:` 匹配到的动态参数。

### 1.3 托管静态资源

#### express.static

express 提供了一个非常好用的函数，叫 `express.static()`，通过它，我们可以非常方便地创建一个静态资源服务器，例如，通过如下代码可以将 public 目录下的图片、CSS 文件、JavaScript 文件对外开发访问了：

```js
app.use(express.static("public"));
```

可以访问 public 目录中的所有文件了：

- `http://localhost:3000/images/bg.jpg`
- `http://localhost:3000/css/style.css`
- `http://localhost:3000/js/login.js`

注意：Express 在指定的静态目录中查找文件，并对外提供资源的访问路径。因此，**存放静态文件的目录名不会出现在 URL 中**。

#### 托管多个静态资源目录

多次调用 `express.static()` 函数：

```js
app.use(express.static("public"));
app.use(express.static("files"));
```

访问静态资源文件时，`express.static()` 函数会根据目录的**添加顺序**查找所需的文件。

#### 挂载路径前缀

如果希望在托管的静态资源访问路径之前，挂载路径前缀，则可以使用如下的方式：

```js
app.use("/public", express.static("public"));
```

- `http://localhost:3000/public/images/bg.jpg`
- `http://localhost:3000/public/css/style.css`
- `http://localhost:3000/public/js/login.js`

### 1.4 nodemon

它能监听项目文件的变动，当代码被修改后，nodemon 会自动帮我们重启项目。

安装：`npm install -g nodemon`

使用：`nodemon app.js` 来启动项目，代码被修改之后，会被 nodemon 监听到，从而实现自动重启项目的效果。

## 2. Express 路由

路由就是**映射**关系。

在 Express 中，路由指的是**客户端的请求**和**服务器处理函数**之间的映射关系。

Express 中的路由分 3 部分组成，分别是请求的**类型**、**请求的 URL 地址**、**处理函数**。

```js
app.METHOD(PATH, HANDLER);
```

**路由的匹配**过程：每当一个请求到达服务器之后，需要先经过路由的匹配，只有匹配成功之后，才会调用对应的处理函数。

在匹配时，会按照路由的顺序进行匹配，如果请求类型和请求的 URL 同时匹配成功，则 Express 会将这个请求，转交给对应的 function 函数进行处理。

匹配注意点：1. 按照定义的**先后顺序**进行匹配。2. **请求类型**和**请求的 URL**同时匹配成功，才会调用对应的处理函数。

### 模块化路由

1. 创建路由模块对应的 .js 文件。
2. 调用 `express.Router()` 函数创建路由对象。
3. 像路由对象上挂载具体的模块。
4. 使用 `module.exports` 向外共享路由对象
5. 使用 `app.use()` 函数注册路由模块。

`app.use()` 函数的作用，就是用来注册全局中间件。

```js
// router.js
// 这是路由模块
// 1. 导入 express
const express = require("express");
// 2. 创建路由对象
const router = express.Router();

// 3.挂载具体的路由
router.get("/user/list", (req, res) => {
  res.send("Get user list.");
});
router.post("/user/add", (req, res) => {
  res.send("Add New user.");
});
// 4. 向外导出路由对象
module.exports = router;

// 注册路由模块
// app.js
const express = require("express");
const app = express();

// 1. 导入路由模块
const router = require("./router.js");
// 2. 注册路由模块
// app.use(router);
app.use("/api", router); // 添加前缀 - api

app.listen("80", () => {
  console.log("服务已启动！");
});
```
