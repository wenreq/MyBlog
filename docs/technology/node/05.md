---
title: 模块化和包
lang: zh-CN
---

## 目标

- 模块化的好处
- CommonJS 规定的内容
- Node.js 中模块的三个分类各自是什么
- 使用 npm 管理包
- 了解什么是规范的包结构
- 了解模块的加载机制

## 模块化的好处

- 复用性
- 可维护性
- 按需加载

### 加载模块

`require()` 加载需要的内置、用户自定义、第三方模块。

```js
// 1. 加载内置的 fs 模块
const fs = require('fs')

// 2. 加载用户自定义模块
const custom = require('./custom.js')

// 3. 加载第三方模块
const moment = require('momnet')
```

## CommonJS 规定的内容

- 每个模块内部，**module 变量**代表当前模块。
- module 变量是一个对象，它的 exports 属性（即 **module.exports**）**是对外的接口**。
- 加载某个模块，其实就是加载该模块的 module.exports 属性。**require() 方法用于加载模块**。

### 引用模块

包的语义化规范：

1. major: 大版本
2. minor: 功能版本
3. patch: Bug 修复版本

`npm init -y` 初始化package.json 文件。

`npm i moment` 安装一个包。

`npm i jquery art-template` 一次性安装多个包。

dependencies 记录你使用 npm install 命令安装了那些包。

执行 npm install 命令时，npm 包管理工具会先读取 package.json 中的 dependencies 节点，读取到记录的所有依赖包名称和版本号之后，npm 包管理工具会把这些包一次性下载到项目中。

devDependencies 某些包只在项目开发阶段会用到，在项目上线之后不会用到，则建议把这些包记录到 devDependencies 节点中。开发和项目上线后都需要用到，则记录到 dependencies 节点中。

```sh
npm i 包名 -D
npm install 包名 --save-dev
```

### 向外暴露成员

```js
console.log(exports === module.exports)
```

require() 模块时，得到的永远是 `module.exports` 指向的对象。

镜像：是一种文件存储形式，一个磁盘上的数据在另外一个磁盘上存在一个完全相同的副本，即为镜像。

```sh
# 检查当前的下包镜像源
npm config get registry

# 将下包的镜像源切换为淘宝镜像源
npm config set registry=https://registry.npm.taobao.org/

# 检查镜像源是否下载成功
npm config get registry
```

切换下包镜像源

```sh
# 通过 npm 包管理器，将 nrm 安装到全局
npm i -g nrm

# 查看所有可用的镜像源
nrm ls

# 将下包的镜像源切换到 taobao
nrm use taobao
```

```sh
# 开发依赖包（会被记录到 devDependencies 节点下）
npm i 包名 -D
# 核心依赖包（会被记录到 dependencies 节点下）
npm i 包名
```

全局包 使用 `-g` 。会被安装到 C:\Users\Administrator\AppData\Roaming\npm\node_modules 目录下。

`i5ting_toc`

可以把 md 文档转为 html 页面的小工具，使用步骤如下：

```sh
# 将 i5ting_toc 安装为全局包
npm i -g i5ting_toc

# 调用 i5ting_toc ，轻松实现 md 转 html 的功能
i5ting_toc -f 要转换的md文件路径 -o
```
