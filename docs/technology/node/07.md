---
title: 数据库和身份认证
lang: zh-CN
---

## 目标

- 知道如何配置 MySql 数据库环境
- 认识并使用常见的 SQL 语句操作数据库
- 在 Express 中操作 MySql 数据库
- 了解 Session 的实现原理
- 了解 JWT 的实现原理

## 目录

- 数据库的基本概念
- 安装并配置 MySQL
- MySQL 的基本使用
- 在 Express 中操作 MySQL
- 前后端的身份认证

## 1. 数据库的基本概念

### 1.1 什么是数据库

数据库（database）是用来**组织**、**存储**和**管理**数据的仓库。

当今世界是一个充满着数据的互联网，充斥着大量的数据。**数据的来源**有很多，比如出行记录、消费记录、浏览的网页、发送的消息等等。除了文本类型的数据，图像、音乐、声音都是数据。

为了方便管理互联网世界中的数据，就有了**数据库管理系统**的概念（简称：数据库）。用户可以对数据库中的数据进行**新增**、**查询**、**更新**、**删除**等操作。

### 1.2 常见的数据库及分类

市面上的数据库有很多种，最常见的数据库有如下几个：

- MySQL 数据库（目前**使用最广泛**、**流行度最高**的开源免费数据库；Community + Enterprise）
- Oracle 数据库（收费）
- SQL Server 数据库（收费）
- Mongodb 数据库（Community + Enterprise）

其中，MySQL、Oracle、SQL Server 属于**传统型数据库**（又叫做：**关系型数据库** 或 **SQL 数据库**），这三者的设计理念相同，用法比较类似。

而 Mongodb 属于新型数据库（又叫做：非关系型数据库 或 NoSQL 数据库），它在一定程度上弥补了传统型数据库的缺陷。

### 1.3 传统型数据库的数据组织结构

数据的组织结构：指的就是数据以什么样的结构进行存储。

传统型数据库的数据组织结构，与 Excel 中数据的组织结构比较类似。因此，我们可以对比着 Excel 来了解和学习传统型数据库的数据组织结构。

#### 1. Excel 的数据组织结构

每个 Excel 中，数据的组织结构分别为**工作簿**、**工作表**、**数据行**、**列**这 4 大部分组成。

- 整个 Excel 叫做工作簿
- users 和 books 是工作表
- users 工作表中有三行数据
- 每行数据由 6 列信息组成
- 每列信息都有对应的数据类型

#### 2. 传统型数据库的数据组织结构

在传统型数据库中，数据的组织结构分为数据库（database）、数据表（table）、数据行（row）、字段（field）这 4 大部分组成。

- 数据库类似于 Excel 的工作簿
- 数据表类似于 Excel 的工作表
- 数据行类似于 Excel 的每一行数据
- 字段类似于 Excel 的列
- 每个字段都有对应的数据类型

#### 3. 实际开发中库、表、行、字段的关系

- 在实际项目开发中，一般情况下，每个项目都对应**独立的数据库**。
- 不同的数据，要存储到数据库的不同表中，例如：用户数据存储到 users 表中，图书数据存储到 books 表中。
- 每个表中具体存储哪些信息，有字段来决定，例如：我们可以为 users 表设计 id、username、password 这 3 个字段。
- 表中的行，代表每一条具体的数据。

## 2. 安装和配置 MySQL

### 2.1 了解需要安装哪些 MySQL 相关的软件

对于开发人员来说，只需要按照 `MySQL Server` 和 `MySQL Workbench` 这两个软件，就能满足开发的需求了。

- MySQL Server：专门用来**提供数据存储**和服务的软件。
- MySQL Workbench：可视化的 MySQL 管理工具，通过它，可以方便的**操作存储**在 MySQL Server 中的数据。

### 2.2 MySQL 在 Windows 环境下的安装

在 Window 环境下安装 MySQL，只需要运行 `mysql-installer-community-8.0.29.0.msi` 这个安装包，就能一次性将 `MySQL Server` 和 `MySQL Workbench` 安装到自己的电脑上。

[MySQL](https://dev.mysql.com/downloads/installer/)

## 3. MySQL 的基本使用

### 3.1 使用 MySQL Workbench 管理数据库

DataType 数据类型：

1. `init` 整数
2. `varchar(len)` 字符串
3. `tinyint(1)` 布尔值

字段的特殊标识：

1. `PK`(Primary Key) 主键、唯一标识
2. `NN`(Not Null) 值不允许为空
3. `UQ`(Unique) 值唯一
4. `AI`(Auto Increment) 值自动增长

### 3.2 使用 SQL 管理数据库

#### 1. 什么是 SQL

SQL (英文全称：Structured Query Language) 是**结构化查询语言**，专门用来**访问和处理数据库**的编程语言。能够让我们**以编程的形式，操作数据库里面的数据**。

三个关键点：

1. SQL 是一门**数据库编程语言**
2. 使用 SQL 语言编写出来的代码，叫做 **SQL 语句**。
3. SQL 语言**只能在关系型数据库中使用**（例如 MySQL、Oracle、SQL Server）。非关系型数据库（例如 Mongodb）不支持 SQL 语言。

#### 2. SQL 能做什么

1. 从数据库中**查询**数据
2. 向数据库中**插入**新的数据
3. **更新**数据库中的数据
4. 从数据库删除数据
5. 可以创建新数据库
6. 可在数据库中创建新表
7. 可在数据库中创建存储过程、视图
8. etc...

#### 3 SQL 的学习目标

重点掌握如何使用 SQL 从数据表中：

查询数据（select）、插入数据（insert into）、更新数据（update）、删除数据（delete）

额外需要掌握的 4 种 SQL 语法：`where 条件`、`and 和 or 运算符`、`order by 排序`、`count(*) 函数`

### 3.3 SQL 的 SELECT 语句

#### 1. 语法

SELECT 语句用于从表中**查询**数据。执行的结果被存储在一个结果表中（称为**结果集**）。

```sql
-- 这是注释
-- 从 FROM 指定的【表中】，查询出【所有的】数据。* 表示【所有的列】
SELECT * FROM 表名称

-- 从 FROM 指定的【表中】，查询出指定列名称（字段）的数据
SELECT 列名称 FROM 表名称
```

注意：SQL 语句中的关键字对**大小写不敏感**。SELECT 等效于 select，FROM 等效于 from。

#### 2. `SELECT *` 示例

我们希望从 users 表中选取所有的列，可以使用符号 `*` 取代列的名称。

```sql
SELECT * FROM users
```

#### 3. SELECT 列名称 示例

如需获取名为 "username" 和 "password" 的列的内容（从名为 "users" 的数据表）

```sql
SELECT username, password FROM users
```

### 3.4 SQL 的 INSERT INTO 语句

#### 1. 语句

INSERT INTO 语句用于向数据表中**插入新的**数据行。

```sql
-- 语法解读：向指定的表中，插入如下几列数据，列的值通过 values 一一指定
-- 注意：列和值要一一对应，多个列和多个值之间，使用英文逗号分隔
INSERT INTO table_name (列1, 列2, ...) VALUES (值1, 值2, ...)
```

#### 2. `INSERT INTO` 示例

向 users 表中，插入一条 username 为 tony，password 为 098123 的用户数据。

```sql
INSERT INTO users (username, password) values ('tony', '098123')
```

### 3.5 SQL 的 UPDATE 语句

#### 1. 语句

Update 语句用于修改表中的数据。

```sql
-- 语法解读：
-- 1. 用 UPDATE 指定要更新那个表中的数据
-- 2. 用 SET 指定列对应的新值
-- 3. 用 WHERE 指定更新的条件
UPDATE 表名称 SET 列名称 = 新值 WHERE 列名称 = 某值
```

#### 2. UPDATE 示例 - 更新某一行中的一个列

把 users 表中的 id 为 4 的用户密码，更新为 888888。

```sql
UPDATE users SET password = 88888 WHERE id = 7
```

#### 3 UPDATE 示例 - 更新某一个中的若干列

把 users 表中 id 为 2 的用户密码和用户状态，分别更新为 admin123 和 1。

```sql
UPDATE users SET password='admin123', status=1 WHERE id=2
```

多个被更新的列之间，使用英文的**逗号**进行分隔。WHERE 后面跟着的是更新条件。注意：初学者经常忘记提供更新的 WHERE 条件，这样会导致整张表的数据都被更新，**一定要谨慎**。

### 3.6 SQL 的 DELETE 语句

#### 1. 语句

DELETE 语句用于删除表中的行。

```sql
-- 语法解读
-- 从指定的表中，根据 WHERE 条件，删除对应的数据行
DELETE FROM 表名称 WHERE 列名称 = 值
```

#### 2. DELETE 示例

从 users 表中，删除 id 为 4 的用户。

```sql
DELETE FROM users WHERE id = 4
```

### 3.7 SQL 的 WHERE 子句

#### 1. 语句

WHERE 子句用于**限定选择的标准**。在 `SELECT`、`UPDATE`、`DELETE` 语句中，皆可使用 WHERE 子句来限定选择的标准。

```sql
-- 查询语句中的 WHERE 条件
SELECT 列名称 FROM 表名称 WHERE 列 运算符 值
-- 更新语句中的 WHERE 条件
UPDATE 表名称 SET 列=新值 WHERE 列 运算符 值
-- 删除语句中的 WHERE 条件
DELETE FROM 表名称 WHERE 列 运算符 值
```

#### 2. 可以在 WHERE 子句中使用的运算符

下面的运算符可在 WHERE 子句中使用，用来限定选择的标准：

| 操作符  |     描述     |
| ------- | :----------: |
| =       |     等于     |
| `<>`    |    不等于    |
| >       |     大于     |
| `<`     |     小于     |
| >=      |   大于等于   |
| `<=`    |   小于等于   |
| BETWEEN | 在某个范围内 |
| LIKE    | 搜索某种模式 |

注意：在某些版本的 SQL 中，操作符 `<>` 可以写成 `!=`

#### 3. WHERE 子句示例

可以通过 WHERE 子句来限定 SELECT 查询条件：

```sql
-- 查询 status 为 1 的所有用户
SELECT * FROM users WHERE status=1
-- 查询 id 大于 2 的所有用户
SELECT * FROM users WHERE id>2
-- 查询 username 不等于 admin 的所有用户
SELECT * FROM users WHERE username<>'admin'
```
